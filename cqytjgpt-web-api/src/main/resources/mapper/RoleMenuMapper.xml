<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ccttic.mapper.role.RoleMenuMapper">
	<!-- 自定义返回结果集 -->
	<resultMap id="roleMenuMap" type="com.ccttic.entity.role.RoleMenu">
		<id property="id" column="id" javaType="java.lang.String"></id>
		<result property="roleId" column="role_id" javaType="java.lang.String"></result>
		<result property="menuId" column="menu_id" javaType="java.lang.String"></result>
		<result property="version" column="version" javaType="java.lang.Integer"></result>
	</resultMap>
	
	<!-- 自定义返回结果集 -->
	<resultMap id="allRoleMenuList" type="com.ccttic.entity.role.vo.RoleMenuVo">
		<result property="roleCd" column="roleCd" javaType="java.lang.String"></result>
		<result property="roleNm" column="roleNm" javaType="java.lang.String"></result>
		<result property="menu_id" column="menu_id" javaType="java.lang.String"></result>
		<result property="path" column="path" javaType="java.lang.String"></result>
	</resultMap>
	<!-- 通过角色ID删除角色菜单关系表-->
	<delete id="deleteRoleMenuByRoleId" parameterType="java.lang.String">
		delete from ess_role_menu where role_id=#{roleId}
	</delete>
	<!-- 批量增加角色菜单关系 -->
	<insert id="setRoleResource" parameterType="java.util.List">
	   insert into ess_role_menu (id,role_id,menu_id,version) values 
	    <foreach collection="rms" item="rm" separator=",">
	     (#{rm.id},#{rm.roleId},#{rm.menuId},#{rm.version})
	    </foreach>
	</insert>
	<!-- 获取角色已有权限菜单-->
	<select id="findRoleResources" parameterType="java.lang.String" resultMap="roleMenuMap">
		select * from ess_role_menu where role_id = #{roleId}  
	</select>
	<!-- 获取所有角色的权限菜单-->
	<select id="findRoleAllResources" resultMap="allRoleMenuList">
		SELECT t1.roleCd,t1.roleNm,t1.menu_id,m.id,m.path from (SELECT r.roleCd,r.roleNm,rm.menu_id FROM `ess_role` r , ess_role_menu rm  where r.id=rm.role_id and r.isDeleted=0) as t1,res_menu as m where t1.menu_id=m.id and m.path !=''
	</select>	
</mapper>	