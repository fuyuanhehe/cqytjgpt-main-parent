<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ccttic.cqytjgpt.webapi.mapper.drivers.DriverMapper">
	<resultMap id="BaseResultMap" type="com.ccttic.entity.drivers.Driver">
		<id column="id" jdbcType="VARCHAR" property="id" />
		<result column="name" jdbcType="VARCHAR" property="name" />
		<result column="idcard" jdbcType="VARCHAR" property="idcard" />
		<result column="telphone" jdbcType="VARCHAR" property="telphone" />
		<result column="mobilephone" jdbcType="VARCHAR" property="mobilephone" />
		<result column="adress" jdbcType="VARCHAR" property="adress" />
		<result column="permiCar" jdbcType="VARCHAR" property="permicar" />
		<result column="firstReciveTime" jdbcType="VARCHAR" property="firstrecivetime" />
		<result column="mgrDepart" jdbcType="VARCHAR" property="mgrdepart" />
		<result column="mgrDepartAreaId" jdbcType="VARCHAR" property="mgrdepartareaid" />
		<result column="mgrEnterpriseId" jdbcType="VARCHAR" property="mgrenterpriseid" />
		<result column="nextExamineTime" jdbcType="VARCHAR" property="nextexaminetime" />
		<result column="effectStartTime" jdbcType="VARCHAR" property="effectstarttime" />
		<result column="effectEndTime" jdbcType="VARCHAR" property="effectendtime" />
		<result column="examineEffectEndTime" jdbcType="VARCHAR"
			property="examineeffectendtime" />
		<result column="scoreTotal" jdbcType="VARCHAR" property="scoretotal" />
		<result column="state" jdbcType="VARCHAR" property="state" />
		<result column="remark" jdbcType="VARCHAR" property="remark" />
		<result column="version" jdbcType="INTEGER" property="version" />
		<result column="isDelete" jdbcType="TINYINT" property="isdelete" />
		<result column="createTime" jdbcType="TIMESTAMP" property="createtime" />
		<result column="updateTime" jdbcType="TIMESTAMP" property="updatetime" />
		<result column="deleteTime" jdbcType="TIMESTAMP" property="deletetime" />
		<result column="createBy" jdbcType="VARCHAR" property="createby" />
		<result column="createDepCd" jdbcType="VARCHAR" property="createdepcd" />
		<result column="updateBy" jdbcType="VARCHAR" property="updateby" />
		<result column="updateDepCd" jdbcType="VARCHAR" property="updatedepcd" />
	</resultMap>
	<sql id="Base_Column_List">
		id, name, idcard, telphone, mobilephone, adress, permiCar,
		firstReciveTime, mgrDepart,
		mgrDepartAreaId, mgrEnterpriseId,
		nextExamineTime, effectStartTime, effectEndTime,
		examineEffectEndTime,
		scoreTotal, state, remark, version, isDelete,
		createTime, updateTime,
		deleteTime, createBy, createDepCd, updateBy, updateDepCd
	</sql>
	<!-- 获取所有准假车型 -->
	<select id="getAllpermiCar" resultType="com.ccttic.entity.drivers.vo.PermiCarsVo">
		SELECT DISTINCT
		permiCar
		FROM
		driver
		WHERE
		permiCar != '' and (isDelete is null OR isDelete !=1)
	</select>


	<!--增加驾驶员 -->
	<insert id="insertSelective" parameterType="java.util.List">
		insert into driver (id,idcard) values
		<foreach collection="list" item="item" index="index"
			separator=",">
			( #{item.id}, #{item.idcard} )
		</foreach>

	</insert>

	<sql id="names">
		replace(`name`,' ','') name,

	</sql>
	<sql id="dnames">
		trim(REPLACE(`name`, ' ', '')) LIKE
		trim(REPLACE('%${name}%', ' ', ''))
	</sql>

	<!-- 驾驶员分页 -->
	<select id="seDriverPage" resultType="com.ccttic.entity.drivers.vo.DriverVo"
		parameterType="java.util.Map">
		SELECT
		d.id,
		d.adress,
		a.areaNm,
		<include refid="names"></include>
		d.idcard,
		d.mobilephone,
		en.etpNm,
		d.permiCar,
		d.firstReciveTime,
		d.nextExamineTime,
		CASE d.state
		WHEN
		'A' THEN
		'正常'
		WHEN
		'B' THEN
		'超分'
		WHEN
		'C'
		THEN
		'转出'
		WHEN
		'D' THEN
		'暂扣'
		WHEN
		'E' THEN
		'撤销'
		WHEN
		'F' THEN
		'吊销'
		WHEN
		'G' THEN
		'注销'
		WHEN
		'H' THEN
		'违法未处理'
		WHEN
		'I' THEN
		'事故未处理'
		WHEN
		'J' THEN
		'停止使用'
		WHEN
		'K'
		THEN
		'扣押'
		WHEN
		'L' THEN
		'锁定'
		WHEN
		'M' THEN
		'逾期未换证'
		WHEN
		'N' THEN
		'延期换证'
		WHEN
		'P'
		THEN
		'延期体检'
		WHEN
		'R' THEN
		'注销可恢复'
		WHEN
		'延期审验' THEN
		'正常'
		WHEN
		'U' THEN
		'扣留'
		WHEN
		'S' THEN
		'逾期未审验'
		else '不明确'
		end as state,
		d.mgrDepart,
		d.telphone,
		d.scoreTotal,
		d.examineEffectEndTime,
		d.effectStartTime,
		d.effectEndTime,
		CASE d.state1
		WHEN
		'A' THEN
		'正常'
		WHEN
		'B' THEN
		'超分'
		WHEN
		'C'
		THEN
		'转出'
		WHEN
		'D' THEN
		'暂扣'
		WHEN
		'E' THEN
		'撤销'
		WHEN
		'F' THEN
		'吊销'
		WHEN
		'G' THEN
		'注销'
		WHEN
		'H' THEN
		'违法未处理'
		WHEN
		'I' THEN
		'事故未处理'
		WHEN
		'J' THEN
		'停止使用'
		WHEN
		'K'
		THEN
		'扣押'
		WHEN
		'L' THEN
		'锁定'
		WHEN
		'M' THEN
		'预期未换证'
		WHEN
		'N' THEN
		'延期换证'
		WHEN
		'P'
		THEN
		'延期体检'
		WHEN
		'R' THEN
		'注销可恢复'
		WHEN
		'T' THEN
		'延期审验'
		WHEN
		'U' THEN
		'扣留'
		WHEN
		'S' THEN
		'逾期未审验'
		else '不明确'
		END as state1
		FROM
		ess_area a
		LEFT JOIN driver d
		ON a.id =
		d.mgrDepartAreaId
		LEFT JOIN ess_enterprise
		en ON
		d.mgrEnterpriseId =
		en.id
		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where en.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		and d.id != ''
		<if test="etpNm!=null and etpNm!='' ">
			and en.etpNm like '%${etpNm}%'
		</if>
		<if test="areaNm!=null and areaNm!='' ">
			and a.areaNm = #{areaNm}
		</if>
		<if test="name!=null and name!='' ">
			and
			<include refid="dnames"></include>
		</if>
		<if test="idcard!=null and idcard!='' ">
			and d.idcard = #{idcard}
		</if>
		<if test="permicar!=null and permicar!='' ">
			and d.permiCar like '%${permicar}%'
		</if>
		<if test="id!=null and id!='' ">
			and d.id = #{id}
		</if>
		<if test="mobilephone!=null and mobilephone!='' ">
			and d.mobilephone = #{mobilephone}
		</if>
		<if test="fiString!=null and fiString!=''  ">
			and d.firstReciveTime BETWEEN #{fiString} and
			#{laString}
		</if>
		<if test="fistShString!=null and fistShString!='' ">
			and d.nextexaminetime BETWEEN #{fistShString} and
			#{laShString}
		</if>
		and (a.isDeleted is null OR a.isDeleted !=1)
		limit
		${startRecord},${pageSize}
	</select>
	<!-- 驾驶人分页总数 -->
	<select id="sePageCount" resultType="long">

		SELECT
		COUNT(d.id)
		FROM
		ess_area a
		LEFT JOIN driver d ON a.id =
		d.mgrDepartAreaId
		LEFT JOIN ess_enterprise en ON d.mgrEnterpriseId =
		en.id


		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where en.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		and d.id != ''
		<if test="etpNm!=null and etpNm!='' ">
			and en.etpNm like '%${etpNm}%'
		</if>
		<if test="areaNm!=null and areaNm!='' ">
			and a.areaNm = #{areaNm}
		</if>
		<if test="name!=null and name!='' ">
			and trim(REPLACE(`name`, ' ', '')) LIKE
			trim(REPLACE('%${name}%', ' ', ''))
		</if>
		<if test="idcard!=null and idcard!='' ">
			and d.idcard = #{idcard}
		</if>
		<if test="permicar!=null and permicar!='' ">
			and d.permiCar like '%${permicar}%'
		</if>
		<if test="id!=null and id!='' ">
			and d.id = #{id}
		</if>
		<if test="mobilephone!=null and mobilephone!='' ">
			and d.mobilephone = #{mobilephone}
		</if>
		<if test="fiString!=null and fiString!='' ">
			and d.firstReciveTime BETWEEN #{fiString} and
			#{laString}
		</if>
		<if test="fistShString!=null and fistShString!='' ">
			and d.nextexaminetime BETWEEN #{fistShString} and
			#{laShString}
		</if>
		and (a.isDeleted is null OR a.isDeleted !=1)
	</select>
	<!--驾驶人违法记录 -->
	<select id="seDrillicitByDriverId" parameterType="java.util.Map"
		resultType="com.ccttic.entity.drivers.vo.DriverillicitVo">

		SELECT
		e.etpNm,
		replace(vd.name,' ','') name,
		vd.illicitTime,
		vd.illicitAdress,
		vd.illicitScore,
		vd.illicitAmount,
		vd.mgrDepart,
		vd.drIllicitState

		FROM
		vehi_dr_illicit2018 vd
		LEFT JOIN vehicle v ON v.id
		= vd.vehicle_id
		LEFT
		JOIN ess_enterprise e ON e.id = v.mgrEnterpriseId

		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>

		and vd.idcard = #{idcard}
		and (vd.isDeleted is null OR
		vd.isDeleted
		!=1)
		limit
		${startRecord} ,
		${pageSize}
	</select>
	<select id="seDrillicitByDriverIdCount" parameterType="java.util.Map"
		resultType="long">
		SELECT
		count(vd.id)
		FROM
		vehi_dr_illicit2018 vd
		LEFT JOIN vehicle v ON
		v.id = vd.vehicle_id
		LEFT
		JOIN ess_enterprise e ON e.id =
		v.mgrEnterpriseId

		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>

		and vd.idcard = #{idcard}
		and (vd.isDeleted is null OR
		vd.isDeleted
		!=1)

	</select>

	<!--驾驶人违法信息条件分页 驾驶人信息-信息记录 -->
	<select id="seDr_illicitPages" resultType="com.ccttic.entity.drivers.vo.DriverillicitVo"
		parameterType="java.util.Map">
		SELECT
		vd.id,
		a.areaNm,
		e.etpNm,
		REPLACE (vd. NAME, ' ', '') NAME,
		vd.illicitTime,
		vd.illicitAdress,
		vd.illicitScore,
		vd.illicitAmount,
		vd.mgrDepart,
        ict.illegal_name AS illicit,
        CASE vd.drState WHEN '001' THEN '未处理' WHEN '002' THEN '处理中' WHEN '003' THEN '已处理' ELSE '' END drIllicitState
		FROM
		${dring} vd
		LEFT JOIN
		vehicle v ON vd.vehicle_id = v.id
		LEFT JOIN ess_enterprise e
		ON
		v.mgrEnterpriseId = e.id
		LEFT JOIN ess_organization o ON e.org_id =
		o.id
		LEFT JOIN ess_area a ON o.area_id = a.id
        LEFT JOIN  illegal_comparison_table ict ON  ict.code = vd.illicit
		<choose>
			<when test="empType == 'SUPERMAN'">
				WHERE 1=1
			</when>
			<otherwise>
				WHERE e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		<if test="id!=null and id!='' ">
			and vd.id = #{id}
		</if>
		<if test="name !=null and name!='' ">
			and trim(REPLACE(vd.name, ' ', '')) LIKE
			trim(REPLACE('%${name}%', ' ', ''))
		</if>
		<if test="etpNm!=null and etpNm!='' ">
			and e.etpNm like '%${etpNm}%'
		</if>
		<if test="areaNm!=null and areaNm!='' ">
			and a.areaNm = #{areaNm}
		</if>
		<if test="illicitadress!=null and illicitadress!='' ">
			and vd.illicitadress = #{illicitadress}
		</if>
		<if test="illicit!=null and illicit!='' ">
			and vd.illicit = #{illicit}
		</if>
		<if test="fiString!=null and fiString!='' ">
			and vd.illicitTime BETWEEN #{fiString} and
			#{laString}
		</if>
		AND vd.idcard != NULL
 		limit
		${startRecord} ,
		${pageSize}
	</select>
	<!-- 驾驶人违法分页总数 驾驶人信息-信息记录 -->
	<select id="getDriverPageCount" resultType="long" parameterType="java.util.Map"
		>
		SELECT
		count(vd.id)
		FROM
		${dring} vd
		LEFT JOIN vehicle v ON vd.vehicle_id
		= v.id
		LEFT JOIN ess_enterprise
		e
		ON v.mgrEnterpriseId = e.id
		LEFT JOIN
		ess_organization o ON e.org_id =
		o.id
		LEFT JOIN ess_area a ON o.area_id
		= a.id
		<choose>
			<when test="empType == 'SUPERMAN'">
				WHERE 1=1
			</when>
			<otherwise>
				WHERE e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		<if test="id!=null and id!='' ">
			and vd.id = #{id}
		</if>
		<if test="name!=null and name!='' ">
			and trim(REPLACE(vd.name, ' ', '')) LIKE
			trim(REPLACE('%${name}%', ' ', ''))
		</if>
		<if test="etpNm!=null and etpNm!='' ">
			and e.etpNm like '%${etpNm}%'
		</if>
		<if test="areaNm!=null and areaNm!='' ">
			and a.areaNm = #{areaNm}
		</if>
		<if test="illicitadress!=null and illicitadress!='' ">
			and vd.illicitAdress = #{illicitadress}
		</if>
		<if test="illicit!=null and illicit!='' ">
			and vd.illicit = #{illicit}
		</if>
		<if test="fiString!=null and fiString!='' ">
			and vd.illicitTime BETWEEN #{fiString} and
			#{laString}
		</if>
	</select>

	<!-- 一对多查询关联 -->
	<resultMap type="com.ccttic.entity.drivers.vo.DriverIllegal"
		id="slist">
		<!-- 实体类属性对应数据库的主键字段，不然主键会查不到 -->
		<id property="id" column="id" />
		<!-- 用collection标签 ,也是实体类属性要对应数据库字段 -->
		<collection property="drIllicits" column="id"
			select="com.ccttic.cqytjgpt.webapi.mapper.drivers.DriverMapper.selectByDriverId">
		</collection>
	</resultMap>


	<!--<select id="selectAllDriver" resultMap="slist"> -->
	<!--select * from driver -->
	<!--where isDelete = 0 or isDelete is null -->
	<!--</select> -->
	<!--<select id="selectByDriverId" parameterType="java.lang.String" -->
	<!--resultType="com.ccttic.entity.illegal.DrIllicit"> -->
	<!--select * from dr_illicit where driver_id = #{driverId} and -->
	<!--(isDeleted = 0 or -->
	<!--isDeleted is null) -->
	<!--</select> -->

	<select id="getAllDriverMsg" resultType="com.ccttic.entity.drivers.Driver">
		SELECT id , name ,
		idcard , mgrEnterpriseId ,
		DATE_FORMAT(effectEndTime,'%Y-%m-%d') AS
		effectEndTime,DATE_FORMAT(examineEffectEndTime,'%Y-%m-%d') AS
		examineEffectEndTime FROM driver GROUP BY idcard ORDER BY
		effectEndTime
	</select>

	<!-- 企业监管借口 -->

	<!-- 企业信息基本信息分页接口 -->
	<select id="queryEnterprisePage" resultType="com.ccttic.entity.drivers.vo.EnterprisethenVo"
		parameterType="java.util.Map">
		SELECT
		en.id,
		en.ownerTransport,
		a.areaNm,
		en.etpNm,
		en.etpCd,
		en.etpshortNm,
		en.etpLawer,
		en.lawerTel,
		en.etpSafer,
		en.saferTel,
		en.ownerTraffic,
		en.ownerTransport,
		CASE en.state
		WHEN
		1 THEN
		'审核通过'
		WHEN
		0 THEN
		'待审核'
		WHEN
		-1
		THEN
		'审核未通过'
		end as state,
		en.etpTel,
		en.etpAdress,
		en.remark,
		en.etpCd,
		case en.etpType
		when 'I' then '消防企业'
		when 'D' then '出租客运企业'
		when 'Q' then '其他校车企业'
		when 'N' then '教练企业'
		when 'K' then '工程抢险车'
		when 'P' then '小学生校车'
		when 'G' then '租赁企业'
		when 'A' then '非营运企业'
		when 'C' then '公交客运企业'
		when 'H' then '警用企业'
		when 'E' then '旅游客运企业'
		when 'J' then '救护企业'
		when 'M' then '出租转非企业'
		when 'L' then '营转非企业'
		when 'F' then '货运企业'
		when 'R' then '危化品运输企业'
		when 'O' then '幼儿校车企业'
		else '不明确'
		end as etpType,
		en.issueCardDate,
		en.roadTransport
		FROM
		ess_organization eo
		LEFT
		JOIN ess_enterprise en ON
		en.org_id = eo.id
		LEFT
		JOIN ess_area a ON
		eo.area_id = a.id
		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where en.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>

		<if test="areaNm!= null and areaNm!='' ">
			and a.areaNm = #{areaNm}
		</if>
		<if test="id!= null and id!='' ">
			and en.id = #{id}
		</if>
		<if test="etpNm!= null and etpNm!='' ">
			and en.etpNm like '%${etpNm}%'
		</if>
		<if test="ownerTraffic!= null and ownerTraffic!='' ">
			and en.ownerTraffic = #{ownerTraffic}
		</if>
		<if test="ownerTransport!= null and ownerTransport!='' ">
			and en.ownerTransport = #{ownerTransport}
		</if>
		<if test="etpCd!= null and etpCd!='' ">
			and en.etpCd = #{etpCd}
		</if>
		and (en.isDeleted is null OR en.isDeleted !=1)
		AND en.id != ''
		limit
		${startRecord} ,
		${pageSize}

	</select>

	<select id="queryEnterprisePageCount" resultType="long"
		parameterType="java.util.Map">
		SELECT
		COUNT(en.id)
		FROM
		ess_organization eo
		LEFT JOIN ess_enterprise en
		ON en.org_id = eo.id
		LEFT JOIN ess_area a ON eo.area_id = a.id
		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		<if test="areaNm!= null and areaNm!='' ">
			and a.areaNm = #{areaNm}
		</if>
		<if test="id!= null and id!='' ">
			and en.id = #{id}
		</if>
		<if test="etpNm!= null and etpNm!='' ">
			and en.etpNm like '%${etpNm}%'
		</if>
		<if test="ownerTraffic!= null and ownerTraffic!='' ">
			and en.ownerTraffic = #{ownerTraffic}
		</if>
		<if test="ownerTransport!= null and ownerTransport!='' ">
			and en.ownerTransport = #{ownerTransport}
		</if>
		<if test="etpCd!= null and etpCd!='' ">
			and en.etpCd = #{etpCd}
		</if>
		and (en.isDeleted is null OR en.isDeleted !=1)
		AND en.id != ''
	</select>
	<!--企业信息记录分页 违法未处理详情 -->
	<select id="queryVehiclespage" parameterType="java.util.Map"
		resultType="com.ccttic.entity.drivers.vo.vehiclesVo">
		SELECT
		e.etpNm,
		v.vehiNo,
		v.nature,
		v.vehiType,
		v.effectStartTime,
		v.effectEndTime,
		v.updateTime
		FROM
		ess_organization o
		LEFT JOIN
		ess_enterprise e ON
		o.id = e.org_id
		LEFT
		JOIN vehicle v ON e.id =
		v.mgrEnterpriseId
		LEFT JOIN
		vehi_danger vd ON
		v.id = vd.vehicle_id
		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		and e.id != ''
		<if test="orgNm!=null and orgNm!= '' ">
			AND o.orgNm =#{orgNm}
		</if>
		<if test="etpNm!=null and etpNm!= '' ">
			AND e.etpNm like '%${etpNm}%'
		</if>
		<if test="vehiType!=null and vehiType!= '' ">
			AND v.vehiType =#{vehiType}
		</if>
		<if test="id!=null and id!= '' ">
			AND e.id =#{id}
		</if>

		and (o.isDeleted is null OR o.isDeleted !=1)

		limit ${startRecord} ,
		${pageSize}

	</select>
	<!-- 分页总数 -->
	<select id="queryVehiclespageCount" resultType="long"
		parameterType="java.util.Map">
		SELECT
		COUNT(e.id)
		FROM
		ess_organization o
		LEFT JOIN ess_enterprise e ON
		o.id = e.org_id
		LEFT JOIN vehicle v ON e.id = v.mgrEnterpriseId
		LEFT
		JOIN vehi_danger vd ON v.id = vd.vehicle_id
		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		and e.id != ''
		<if test="orgNm!=null and orgNm!= '' ">
			AND o.orgNm =#{orgNm}
		</if>
		<if test="etpNm!=null and etpNm!= '' ">
			AND e.etpNm like '%${etpNm}%'
		</if>
		<if test="vehiType!=null and vehiType!= '' ">
			AND v.vehiType =#{vehiType}
		</if>
		and (o.isDeleted is null OR o.isDeleted !=1)
	</select>
	<select id="seEmp" parameterType="java.util.Map"
		resultType="com.ccttic.entity.employee.EssEmployee">
		select id,empNm from ess_employee limit ${startRecord} ,
		${pageSize}
	</select>
	<select id="seEmpCount" parameterType="java.util.Map"
		resultType="long">
		select count(id) from ess_employee
	</select>
	<!-- 企业信息-信息记录 -->
	<select id="getvehiclesCount" resultType="com.ccttic.entity.drivers.vo.vehiclesVo"
		parameterType="java.util.Map">
		SELECT
		e.etpNm,
		v.vehiNoType,
		vd.overdueExamineState,
		vd.scrappedState,
		vd.illicitState
		FROM
		ess_organization o
		LEFT JOIN ess_enterprise e ON
		o.id = e.org_id
		LEFT JOIN vehicle v ON e.id = v.mgrEnterpriseId
		LEFT
		JOIN vehi_danger vd ON v.id = vd.vehicle_id
		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		and e.id != ''
		<if test="orgNm!=null and orgNm!= '' ">
			AND o.orgNm =#{orgNm}
		</if>
		<if test="etpNm!=null and etpNm!= '' ">
			AND e.etpNm like '%${etpNm}%'
		</if>
		<if test="vehiNoType!=null and vehiNoType!= '' ">
			AND v.vehiNoType =#{vehiNoType}
		</if>
		<if test="id!=null and id!= '' ">
			AND e.id =#{id}
		</if>
		and e.id in
		<foreach collection="list" index="index" item="item"
			separator="," open="(" close=")">
			#{item}
		</foreach>

		and (o.isDeleted is null OR o.isDeleted !=1)

	</select>
	<update id="updateBatch" parameterType="java.util.List">

		update driver
		<trim prefix="set" suffixOverrides=",">
			<trim prefix="permiCar = case" suffix="end,">
				<foreach collection="list" item="item" index="index">
					<if test="item.permicar != null">
						when id = #{item.id,jdbcType=VARCHAR} then
						#{item.permicar,jdbcType=VARCHAR}
					</if>
				</foreach>
			</trim>
			<trim prefix="state = case" suffix="end,">
				<foreach collection="list" item="item" index="index">
					<if test="item.state != null">
						when id = #{item.id,jdbcType=VARCHAR} then
						#{item.state,jdbcType=VARCHAR}
					</if>
				</foreach>
			</trim>
			<trim prefix="effectEndTime = case" suffix="end,">
				<foreach collection="list" item="item" index="index">
					<if test="item.effectendtime != null">
						when id = #{item.id,jdbcType=VARCHAR} then
						#{item.effectendtime,jdbcType=VARCHAR}
					</if>
				</foreach>
			</trim>
		</trim>

		where id in
		<foreach collection="list" index="index" item="item"
			separator="," open="(" close=")">
			#{item.id}
		</foreach>
	</update>

	<delete id="deleteBatch" parameterType="java.util.List">
		DELETE FROM driver where idcard in
		<foreach collection="list" index="index" item="item" open="("
			separator="," close=")">
			#{item}
		</foreach>

	</delete>

	<!--企业信息-信息记录 总数 -->
	<select id="getvehiCount" resultType="com.ccttic.entity.drivers.vo.VehicleCountVo"
		parameterType="com.ccttic.entity.drivers.vo.VehicleCountVo">
		SELECT
		e.id,
		e.etpNm,
		COUNT(v.id) AS vCount
		FROM
		ess_organization o
		LEFT
		JOIN
		ess_enterprise e ON o.id = e.org_id
		LEFT JOIN vehicle v ON
		e.id
		=
		v.mgrEnterpriseId
		LEFT JOIN vehi_danger vd ON v.id =
		vd.vehicle_id
		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		<if test="orgNm!=null and orgNm!='' ">
			and o.orgNm = #{orgNm}
		</if>
		<if test="etpNm!=null and etpNm!='' ">
			and e.etpNm like '%${etpNm}%'
		</if>
		<if test="vehiType!=null and vehiType!='' ">
			and v.vehiType = #{vehiType}
		</if>
		AND e.etpNm != ''
		AND o.isDeleted IS NULL
		OR o.isDeleted != 1
		GROUP BY
		e.etpNm
	</select>
	<!-- 企业信息-信息记录 报废数 -->
	<select id="getvehibCount" resultType="com.ccttic.entity.drivers.vo.VehicleCountVo"
		parameterType="com.ccttic.entity.drivers.vo.VehicleCountVo">
		SELECT
		e.etpNm,
		COUNT(vd.scrappedState) AS vCount
		FROM
		ess_organization o
		LEFT JOIN
		ess_enterprise e ON o.id = e.org_id
		LEFT
		JOIN vehicle v ON
		e.id
		=
		v.mgrEnterpriseId
		LEFT JOIN vehi_danger vd ON
		v.id =
		vd.vehicle_id
		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		<if test="orgNm!=null and orgNm!='' ">
			and o.orgNm = #{orgNm}
		</if>
		<if test="etpNm!=null and etpNm!='' ">
			and e.etpNm like '%${etpNm}%'
		</if>
		<if test="vehiType!=null and vehiType!='' ">
			and v.vehiType = #{vehiType}
		</if>
		and vd.scrappedState = 1
		AND e.etpNm != ''
		AND o.isDeleted IS NULL
		OR
		o.isDeleted != 1
		GROUP BY
		e.etpNm
	</select>
	<!-- 企业信息-信息记录 违法未处理 -->
	<select id="getvehiwCount" resultType="com.ccttic.entity.drivers.vo.VehicleCountVo"
		parameterType="com.ccttic.entity.drivers.vo.VehicleCountVo">
		SELECT
		e.etpNm,
		COUNT(vd.illicitState) AS vCount
		FROM
		ess_organization o
		LEFT JOIN
		ess_enterprise e ON o.id = e.org_id
		LEFT
		JOIN vehicle v ON
		e.id
		=
		v.mgrEnterpriseId
		LEFT JOIN vehi_danger vd ON
		v.id =
		vd.vehicle_id
		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		<if test="orgNm!=null and orgNm!='' ">
			and o.orgNm = #{orgNm}
		</if>
		<if test="etpNm!=null and etpNm!='' ">
			and e.etpNm like '%${etpNm}%'
		</if>
		<if test="vehiType!=null and vehiType!='' ">
			and v.vehiType = #{vehiType}
		</if>
		and vd.illicitState = 1
		AND e.etpNm != ''
		AND o.isDeleted IS NULL
		OR
		o.isDeleted != 1
		GROUP BY
		e.etpNm
	</select>

	<!-- 企业信息-信息记录 逾期 -->
	<select id="getvehiyCount" resultType="com.ccttic.entity.drivers.vo.VehicleCountVo"
		parameterType="com.ccttic.entity.drivers.vo.VehicleCountVo">
		SELECT
		e.etpNm,
		COUNT(vd.overdueExamineState) AS vCount
		FROM
		ess_organization o
		LEFT JOIN
		ess_enterprise e ON o.id = e.org_id
		LEFT
		JOIN vehicle v ON
		e.id =
		v.mgrEnterpriseId
		LEFT JOIN vehi_danger vd ON
		v.id =
		vd.vehicle_id
		<choose>
			<when test="empType == 'SUPERMAN'">
				where 1=1
			</when>
			<otherwise>
				where e.id in
				<foreach collection="list" index="index" item="item" open="("
					separator="," close=")">
					#{item}
				</foreach>
			</otherwise>
		</choose>
		<if test="orgNm!=null and orgNm!='' ">
			and o.orgNm = #{orgNm}
		</if>
		<if test="etpNm!=null and etpNm!='' ">
			and e.etpNm like '%${etpNm}%'
		</if>
		<if test="vehiType!=null and vehiType!='' ">
			and vd.vehiType = #{vehiType}
		</if>
		and vd.overdueExamineState = 1
		AND e.etpNm != ''
		AND o.isDeleted IS NULL
		OR o.isDeleted != 1
		GROUP BY
		e.etpNm
	</select>


</mapper>